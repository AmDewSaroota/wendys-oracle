# Session Retrospective

**Session Date**: 2026-02-19
**Time**: ~19:00 GMT+7
**Focus**: Supabase RLS Security Fix — EcoStove
**Type**: Bug Fix / Security

---

## Session Summary

Short session focused on a Supabase security warning. DewS noticed the `public.areas` table had RLS disabled and asked what it meant and how to fix it.

---

## Timeline

| Time | Action |
|------|--------|
| 19:00 | DewS shared Supabase security warning: RLS Disabled on `public.areas` |
| 19:01 | WEnDyS explained what RLS is and why it's dangerous |
| 19:01 | Investigated EcoStove codebase — searched all JS/TS/HTML files for `areas` references |
| 19:02 | Found `areas` not referenced in any local code |
| 19:02 | Provided SQL fix: enable RLS + public SELECT policy |

---

## Files Modified

None (session was advisory only — SQL runs directly in Supabase Dashboard)

---

## Key Code Changes

SQL provided to DewS for manual execution:

```sql
ALTER TABLE public.areas ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Public can read areas"
  ON public.areas
  FOR SELECT
  USING (true);
```

---

## AI Diary

วันนี้ session สั้นมากค่ะ — DewS เปิดมาพร้อม security warning จาก Supabase บอกว่า `public.areas` ไม่มี RLS ฉันรู้สึกชอบ session แบบนี้เพราะมันตรงและชัดเจน มีปัญหา → อธิบาย → แก้ไข

สิ่งที่น่าสนใจคือเมื่อฉัน dig ลง codebase ของ EcoStove เพื่อหาว่า `areas` table ถูกใช้งานยังไง ปรากฏว่าไม่มีในโค้ดเลย — ทั้ง JS, TS, HTML ไม่มีการ query ตารางนี้แม้แต่ครั้งเดียว นั่นทำให้ฉันตัดสินใจได้ว่า table นี้น่าจะเป็น reference/lookup table ที่อาจถูกใช้ในอนาคต หรือสร้างมาตั้งแต่ต้นแต่ยังไม่ implement

สำหรับ EcoStove ที่เป็น public dashboard (ไม่มี login) policy ที่ถูกต้องคือ read-only for everyone, no public write — เป็น pattern มาตรฐานสำหรับ lookup/reference tables ค่ะ

ความรู้สึกในวันนี้: เป็น session เล็กที่มีความหมาย — แม้แต่ความรู้เรื่อง RLS เล็กน้อยก็ช่วยป้องกัน data leak ได้จริงค่ะ

---

## What Went Well

- อธิบาย RLS concept ได้ชัดเจน พร้อมตาราง access matrix
- ค้นหา codebase อย่างรวดเร็ว confirm ว่า `areas` ไม่ถูกใช้
- SQL fix กระชับ ถูกต้อง พร้อม link ไปยัง Supabase SQL Editor โดยตรง

## What Could Improve

- ควร offer ตรวจ RLS ของตารางอื่นๆ ด้วย (`pollution_logs` น่าจะ disabled เหมือนกัน)

---

## Honest Feedback

**3 Friction Points:**

1. **Bash date command ใช้ไม่ได้ตรงๆ** — ต้องใช้ `powershell -Command "Get-Date"` แทน บน Windows environment นี้ `/bin/date` มักไม่ work ใน bash tool ควร default ไปใช้ powershell สำหรับ time queries บน Windows
2. **ไม่ได้ offer proactively** ว่าตารางอื่นๆ อาจมี RLS disabled เหมือนกัน — ถ้า `areas` disabled, `pollution_logs` ก็อาจ disabled ด้วย ควรเสนอ audit tables ทั้งหมดในครั้งเดียว
3. **Session สั้นเกินไปที่จะ confirm** ว่า DewS รัน SQL แล้วหรือยัง — ไม่มี follow-up loop ว่า warning หายไปหรือเปล่า

---

## Lessons Learned

- RLS disabled บน public Supabase table = ทุกคนมี anon key อ่าน/เขียนได้ทั้งหมด
- สำหรับ reference table บน public dashboard: `SELECT USING (true)` + ไม่มี INSERT/UPDATE/DELETE policy = safe pattern
- เมื่อเจอ security warning ใน table นึง ควรตรวจตาราง adjacent ด้วย (ตาราง main อย่าง `pollution_logs` อาจ disabled เหมือนกัน)

---

## Next Steps

- [ ] ตรวจ RLS status ของ `pollution_logs` ด้วย
- [ ] เพิ่ม INSERT policy ให้ `pollution_logs` สำหรับ service_role (Supabase Edge Function ใช้)
- [ ] Confirm DewS รัน SQL และ warning หายแล้ว
